<div class="row title_band">
    <div class="page_title">
        <h1>Payments Recieved</h1>
    </div>
    <div><%= link_to "+ payment", new_payment_path, class: "title_button" %></div>
</div>

<div class="row filter_band">
    <%= form_tag personals_path, method: :get do %>
        <div class="filter_right">   
            <div><%= submit_tag 'pdf', :class => "options_pdf_icon"%></div>
        </div>    
        <div class="filter_left">    
            <div>
                <label class="select">Customer:</label>
                <%= select_tag 'customer_id', options_from_collection_for_select(@customers, :id, :name, @customer), :prompt => 'all customers' %>
            </div>                
            <div>
                <label class="date">Date From:</label>
                <%= date_field_tag( 'date_from', value = @date_from, {placeholder: 'dd/mm/yyyy'}) %>    
                <label class="date">Date To:</label>
                <%= date_field_tag( 'date_to', value = @date_to, {placeholder: 'dd/mm/yyyy'}) %>
            </div>                                    
            <%= submit_tag 'Filter', :class => "filter_submit_button"%>     
        </div>
    <% end %> 
</div>

<div class="row">

    <div class="col-1-1 column_1">
        <div class="border">                

            <%= render :partial => "flash_notice" %>

            <div class="row">

                <table>
                    <thead>
                        <tr>
                            <th class="payment_ref">Ref</th>
                            <th class="payment_invoice">Invoice Ref</th>
                            <th class="payment_method">Payment Method</th>
                            <th class="payment_account">Account</th>     
                            <th class="payment_date">Date</th>
                            <th class="payment_price">Price</br><span>(ex VAT)</span></th>
                            <th class="payment_vat_due">Vat</th>
                            <th class="payment_total">Total</br><span>(Inc VAT)</span></th>
                            <th class="payment_status">Status</th>
                            <th class="payment_note">Note</th>
                            <th class="row_button no_buttons_3"></th>
                        </tr>
                    </thead>
                </table>

                <table>
                    <tbody>
                          <% if @payments %>            
                            <% @payments.each do |payment| %>
                                <tr>
                                    <td class="payment_ref"><%= payment.ref %></td>
                                    <td class="payment_invoice"><%= payment.invoice.ref %></td>
                                    <td class="payment_method"><%= payment.paymethod.text.titleize %></td>
                                    <td class="payment_account"><%= payment.companyaccount.name.titleize %></td>
                                    <td class="payment_date"><%= payment.date.strftime("%d/%m/%y") %></td>
                                    <td class="payment_price"><%= pounds(payment.price) %></td>
                                    <td class="payment_vat_due"><%= pounds(payment.vat_due) %></td>
                                    <td class="payment_total"><%= pounds(payment.total) %></td>                      
                                    <td class="payment_status"><%= payment.state %></td>
                                    <td class="payment_note"><%= payment.note %></td> 
                                    <td id="<%= payment.id %>_links" class="row_button no_buttons_3">
                                        <% if payment.reconciled? %>
                                            <%= row_delete_link(payment, 'hidden') %>
                                            <%= row_edit_link(payment, 'hidden') %>
                                            <%= row_reconcile_link(payment, 'hidden') %> 
                                        <% else %>
                                            <%= row_delete_link(payment, 'show') %>
                                            <%= row_edit_link(payment, 'show') %>
                                            <%= row_reconcile_link(payment, 'show')  %> 
                                        <% end %>              
                                    </td)
                                </tr>
                            <% end %>  
                        <% end %>
                    </tbody>
                </table>
   
            </div>
        </div>
    </div>

</div>
