<div class="row title_band">
    <div class="page_title">
        <h1><%= current_user.first_name.capitalize %>'s Expenses</h1>
    </div>      
    <div><%= link_to "+ expense", new_personal_path, class: "title_button" %> </div>
    <div><%= link_to "+ mileage", new_mileage_path, class: "title_button" %> </div>
</div>


<div class="filter_band_single">
    <%= form_tag personals_path, method: :get do %>
    <div class="filter_search">
        <div class="filter_project_label">Project:</div>
        <div class="filter_project_input">
            <%= select_tag 'project_id', options_from_collection_for_select(@projects, :id, :name, @project), :prompt => 'all jobs'%>    
        </div>
        <div class="filter_date_1_label">From:</div>
        <div class="filter_date_1_input">
            <%= date_field_tag 'date_from', value = @date_from %>
        </div>
        <div class="filter_date_2_label">To:</div>
        <div class="filter_date_2_input">
            <%= date_field_tag 'date_to', value = @date_to  %>
        </div>
        <div class="filter_submit">
            <%= submit_tag 'Filter', :class => "filter_submit_button"%>
        </div>
    </div>
    <div class="option_band_submit"><%= submit_tag 'pdf', :class => "options_pdf_icon"%></div> 
    <% end %>
</div>



<div class="row">

    <div class="col-1-1 column_1">
        <div class="border">                

            <%= render :partial => "flash_notice" %>
            
            <div class="row">

                <table>
                    <thead>
                        <tr>
                            <th class="personal_due_date">Due Date</th>
                            <th class="personal_job">Job</th>
                            <th class="personal_category">Category</th>
                            <th class="personal_ref">Reference</th>
                            <th class="personal_supplier">Supplier</th>
                            <th class="personal_supplier_ref">Supplier Ref</th>    
                            <th class="personal_issue_date">Issue Date</th>
                            <th width="personal_distance">Distance</th>
                            <th class="personal_price">Price</br><span>(ex VAT)</span></th>
                            <th class="personal_vat_due">Vat</th>
                            <th class="personal_total">Total</br><span>(Inc VAT)</span></th>
                            <th class="personal_status">Status</th>
                            <th class="row_button no_buttons_2"></th>
                        </tr>
                    </thead>
                </table>

                <table>
                    <tbody>
                        <% if @expenses %>            
                            <% @expenses.each do |expense| %>
                                <tr>
                                    <td class="personal_due_date"><%= expense.due_date.strftime("%d/%m/%y") %></td>
                                    <td class="personal_job"><%= expense.project.ref %></td>
                                    <td class="personal_category"><%= expense.hmrcexpcat.category.titleize %></td>
                                    <td class="personal_ref"><%= expense.ref %></td>
                                    <% if expense.hmrcexpcat_id == 1 %>
                                        <td class="personal_supplier"></td>
                                        <td class="personal_supplier_ref"></td>
                                        <td class="personal_issue_date"><%= expense.date.strftime("%d/%m/%y") %></td>
                                        <td width="20px" class="row_button"></td>
                                        <td class="personal_distance"><%= expense.mileage.distance %></td>
                                        <td class="personal_price"></td>
                                        <td class="personal_vat_due"></td>
                                        <td class="personal_total"><%= expense.total %></td>
                                        <td id="<%= expense.id %>_status" class="personal_status"><%= expense.state %></td>
                                        <td id="<%= expense.id %>_links" class="row_button no_buttons_2">
                                        <% if expense.paid? || expense.accepted? %>
                                            <%= link_to '', personal_path(expense), method: :delete, class: 'line_delete_icon_hidden' , title: "delete" %>                         
                                            <%= link_to "", edit_mileage_path(expense.mileage_id), class: 'line_edit_icon_hidden', title: "edit" %>
                                        <% else %>
                                            <%= link_to '', personal_path(expense), method: :delete, class: 'line_delete_icon_show' , title: "delete" %>                       
                                            <%= link_to "", edit_mileage_path(expense.mileage_id), class: 'line_edit_icon_show', title: "edit" %>
                                        <% end %>
                                        </td>
                                    <% else %>
                                        <td class="personal_supplier"><%= expense.supplier.name.titleize %></td>
                                        <td class="personal_supplier_ref"><%= expense.supplier_ref %></td>
                                        <td class="personal_issue_date"><%= expense.date.strftime("%d/%m/%y") %></td>
                                        <td width="20px" class="row_button>
                                            <% if expense.receipt %>
                                                <%= link_to "", personal_path(expense), class: 'line_view_icon', title: "view receipt" %>
                                            <% end %>
                                        </td>
                                        <td class="personal_distance"></td>
                                        <td class="personal_price"><%= pounds(expense.price) %></td>
                                        <td class="personal_vat_due"><%= pounds(expense.vat) %></td>
                                        <td class="personal_total"><%= pounds(expense.total) %></td>
                                        <td id="<%= expense.id %>_status" class="personal_status"><%= expense.state %></td>
                                        <td id="<%= expense.id %>_links" class="row_button no_buttons_2">
                                        <% if expense.paid? || expense.accepted? %>
                                            <%= link_to '', personal_path(expense), method: :delete, class: 'line_delete_icon_hidden' , title: "delete" %>                         
                                            <%= link_to "", edit_personal_path(expense), class: 'line_edit_icon_hidden', title: "edit" %>
                                        <% else %>
                                            <%= link_to '', personal_path(expense), method: :delete, class: 'line_delete_icon_show' , title: "delete" %>                      
                                            <%= link_to "", edit_personal_path(expense), class: 'line_edit_icon_show', title: "edit" %>
                                        <% end %>
                                        </td>                
                                    <% end %>
                                </tr>
                            <% end %>  
                        <% end %>
                    </tbody>
                </table>
   
            </div>
        </div>
    </div>

</div>