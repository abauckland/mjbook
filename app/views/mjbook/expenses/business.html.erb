<div class="page_title">
    <h1>Business Expenses</h1>
    <div class="page_title_button"><%= link_to "add new expense", new_business_path %> </div>
</div>


<div class="filter_band_single">
    <%= form_tag business_path, method: :get do %>
    <div class="filter_search">
        <div class="filter_project_label">Supplier:</div>
        <div class="filter_project_input">
            <%= select_tag 'project_id', options_from_collection_for_select(@suppliers, :id, :company_name, @supplier), :prompt => 'all jobs'%>    
        </div>
        <div class="filter_date_1_label">From:</div>
        <div class="filter_date_1_input">
            <%= date_field_tag 'date_from', value = @date_from %>
        </div>
        <div class="filter_date_2_label">To:</div>
        <div class="filter_date_2_input">
            <%= date_field_tag 'date_to', value = @date_to  %>
        </div>
        <div class="filter_submit">
            <%= submit_tag 'Filter', :class => "filter_submit_button"%>
        </div>
    </div>
    <% end %>
    <div class="option_band_submit"><%= submit_tag 'pdf', :class => "options_pdf_icon"%></div> 
</div>


<div class="table_content_with_filter">
    <table>
      <thead>
        <tr>
          <th class="business_due_data">Due Date</th>
          <th class="business_job">Job</th>
          <th class="business_category">Category</th>
          <th class="business_ref">Reference</th>
          <th class="business_supplier">Supplier</th>
          <th class="business_supplier_ref">Supplier Ref</th>
          <th class="business_issue_date">Issue Date</th>
          <th width="20px" class="row_button">Bill Image</th>
          <th class="business_price">Price</br><span class="vat_note">(ex VAT)</span></th>
          <th class="business_vat_due">Vat</th>
          <th class="business_total">Total</br><span class="vat_note">(Inc VAT)</span></th>
          <th class="business_status">Status</th>
          <th width="100px" class="row_button"></th>
        </tr>
      </thead>
    </table>
    <div class="table_container">
        <table>
          <tbody>
          <% if @businessexpenses %>
            
            <% @businessexpenses.each do |businessexpense| %>
              <tr>
                <td class="business_due_data"><%= businessexpense.due_date.strftime("%d/%m/%y") %></td>
                <td class="business_job"><%= businessexpense.project.ref %></td>
                <td class="business_category"><%= businessexpense.hmrcexpcat.category %></td>
                <td class="business_ref"><%= businessexpense.ref %></td>
                <td class="business_supplier"><%= businessexpense.supplier.company_name %></td>
                <td class="business_supplier_ref"><%= businessexpense.supplier_ref %></td>
                <td class="business_issue_date"><%= businessexpense.date.strftime("%d/%m/%y") %></td>
                <td width="20px">
                    <% if businessexpense.receipt? %>
                        <%= link_to "", expense_path(businessexpense.id), class: 'line_view_icon', title: "view receipt" %>
                    <% end %>
                </td>
                <td class="business_price"><%= pounds(businessexpense.price) %></td>
                <td class="business_vat_due"><%= pounds(businessexpense.vat) %></td>
                <td class="business_total"><%= pounds(businessexpense.total) %></td>
                <td class="business_status"><%= businessexpense.status %></td>
                
                <td id="<%= businessexpense.id %>_links" width="100px" class="row_button">
                    
                    <% if businessexpense.submitted? || businessexpense.rejected? %>
                        <%= row_delete_link(businessexpense, 'show') %>                 
                        <%= link_to "", edit_business_expense_path(businessexpense), class: 'line_edit_icon_show', title: "edit" %>
                        <%= row_accept_link(businessexpense, 'show') %>
                    <% else %>
                        <%= row_delete_link(businessexpense, 'hidden') %>                
                        <%= link_to "", edit_business_expense_path(businessexpense), class: 'line_edit_icon_hidden', title: "edit" %>
                        <%= row_accept_link(businessexpense, 'hidden') %> 
                    <% end %>                                
     
                    <% if businessexpense.submitted? || businessexpense.accepted? %>
                        <%= row_reject_link(businessexpense, 'show') %>                 
                    <% else %>
                        <%= row_reject_link(businessexpense, 'hidden') %>                 
                    <% end %> 
                
                    <% if businessexpense.accepted? %>
                        <%= link_to "", new_expend_path(:expense_id => employeeexpense.id), class: 'line_payment_icon_show', title: "record payment" %>                
                    <% else %>
                        <%= link_to "", new_expend_path(:expense_id => employeeexpense.id), class: 'line_payment_icon_hidden', title: "record payment" %>                 
                    <% end %> 
    
    
                    <%= row_show_link(businessexpense, 'show') %> 

                </td>
              </tr>
              
            <% end %>  
          <% end %>
          </tbody>
        </table>
    </div>
</div>
